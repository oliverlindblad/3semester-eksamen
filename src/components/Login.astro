---
// src/components/Login.astro
const adgangskode = "marathon2025";
---

<!-- Overlay der spærrer for alt indhold -->
<div
  id="login-overlay"
  class="fixed inset-0 flex items-center justify-center bg-gray-100 px-4 z-50"
>
  <div class="w-full max-w-md">
    <!-- 1) Beskyttet velkomstsektion (skjult indtil login) -->
    <div
      id="welcome-section"
      class="hidden bg-white p-6 rounded-xl shadow-lg mb-4 text-center space-y-2"
    >
      <h1 class="text-3xl font-bebas text-orange-700">Velkommen til HCA Marathon</h1>
      <p class="text-base font-instrument">
        Dette indhold er nu synligt, fordi du har skrevet den korrekte adgangskode.
      </p>
    </div>

    <!-- 2) Login-form (synlig indtil korrekt kode) -->
    <form
      id="loginForm"
      class="bg-white p-6 rounded-xl shadow-lg space-y-4"
    >
      <h2 class="text-2xl font-bold text-orange-700 text-center">Adgangskode</h2>
      <input
        type="password"
        id="pw"
        placeholder="Indtast adgangskode"
        class="w-full border-2 border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:border-orange-700"
      />
      <button
        type="submit"
        class="w-full bg-orange-700 text-white font-semibold py-2 rounded-md hover:bg-orange-800 transition"
      >
        Login
      </button>
      <p id="error" class="text-red-600 hidden text-sm">Forkert adgangskode</p>
    </form>
  </div>
</div>

<!-- Alt beskyttet indhold ligger herunder – først synligt efter login -->
<div id="protected-content" class="relative z-0">
  <slot />
</div>

<script type="module">
  const adgangskode = "marathon2025";
  const overlay = document.getElementById("login-overlay");
  const form = document.getElementById("loginForm");
  const welcome = document.getElementById("welcome-section");
  const error = document.getElementById("error");

  // 1) Hvis bruger allerede er logget ind, vis velkomst, skjul form og overlay
  if (sessionStorage.getItem("access") === "granted") {
    form.classList.add("hidden");
    welcome.classList.remove("hidden");
    setTimeout(() => {
      overlay.style.display = "none";
      document.body.style.overflow = "";
    }, 1500);
  } else {
    // 2) Ellers: bloker scroll indtil login
    document.body.style.overflow = "hidden";
  }

  // 3) Håndter login-formular
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const pw = document.getElementById("pw").value;
    if (pw === adgangskode) {
      sessionStorage.setItem("access", "granted");
      // vis velkomstsektion
      form.classList.add("hidden");
      welcome.classList.remove("hidden");
      error.classList.add("hidden");
      // efter et øjeblik, fjern overlay og tillad scroll
      setTimeout(() => {
        overlay.style.display = "none";
        document.body.style.overflow = "";
      }, 3000);
    } else {
      error.classList.remove("hidden");
    }
  });
</script>
